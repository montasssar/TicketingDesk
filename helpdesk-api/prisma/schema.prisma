// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  name         String?
  passwordHash String // <-- FIXED: matches your auth.service.ts
  role         UserRole

  // Relations
  createdTickets  Ticket[]        @relation("CreatedTickets")
  assignedTickets Ticket[]        @relation("AssignedTickets")
  comments        TicketComment[] @relation("UserComments")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Ticket {
  id          Int            @id @default(autoincrement())
  title       String
  description String
  status      TicketStatus   @default(OPEN)
  priority    TicketPriority @default(MEDIUM)

  creatorId Int
  creator   User @relation("CreatedTickets", fields: [creatorId], references: [id])

  assigneeId Int?
  assignee   User? @relation("AssignedTickets", fields: [assigneeId], references: [id])

  comments TicketComment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TicketComment {
  id   Int    @id @default(autoincrement())
  body String

  ticketId Int
  ticket   Ticket @relation(fields: [ticketId], references: [id])

  authorId Int
  author   User @relation("UserComments", fields: [authorId], references: [id])

  createdAt DateTime @default(now())
}

enum UserRole {
  employee
  agent
  admin
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
}
